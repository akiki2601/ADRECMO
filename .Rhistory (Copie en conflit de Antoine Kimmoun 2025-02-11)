pivot_wider(
names_from = "Jour",
values_from = "value",
values_fn = mean,  # Moyenne des doublons
values_fill = NA
)
ADR1$ID
duplicated(ADR1$ID)
ADR2 <- data_list[[2]] %>%
select( "Patient","Jour", "%Total")%>%
filter(!is.na(`%Total`))%>%
rename(value = `%Total`)%>%
mutate(ID = str_replace(Patient, "Patient (\\d+) (\\w+)", "\\1-\\2"))%>%
pivot_wider(
names_from = "Jour",
values_from = "value",
values_fn = mean,  # Moyenne des doublons
values_fill = NA
)
ADR2 <- data_list[[2]] %>%
select( "Patient","Jour", "%Total")%>%
filter(!is.na(`%Total`))%>%
rename(value = `%Total`)%>%
mutate(ID = str_replace(Patient, "Patient (\\d+) (\\w+)", "\\1-\\2"))%>%
pivot_wider(
names_from = "Jour",
values_from = "value",
values_fn = mean,  # Moyenne des doublons
values_fill = NA
)
ADR2
ADR1
ADR1$J5
View(ADR1)
ADR1 <- data_list[[1]] %>%
select( "Patient","Jour", "%Total")%>%
filter(!is.na(`%Total`))%>%
rename(value = `%Total`)%>%
mutate(ID =str_replace(Patient, "Patient (\\d+) (\\w+)", "\\1-\\2"))%>%
pivot_wider(
names_from = "Jour",
values_from = "value",
values_fn = mean,  # Moyenne des doublons
values_fill = NA
)%>%
mutate (`J3-5` = case_when(is.na(`J3-5`)&!is.na(J5)~J5,
T~`J3-5`))
View(ADR1)
ADR1 <- data_list[[1]] %>%
select( "Patient","Jour", "%Total")%>%
filter(!is.na(`%Total`))%>%
rename(value = `%Total`)%>%
mutate(ID =str_replace(Patient, "Patient (\\d+) (\\w+)", "\\1-\\2"))%>%
pivot_wider(
names_from = "Jour",
values_from = "value",
values_fn = mean,  # Moyenne des doublons
values_fill = NA
)%>%
mutate (`J3-5` = case_when(is.na(`J3-5`)&!is.na(J5)~J5,
T~`J3-5`),
JS = case_when(is.na(JS)&!is.na(`J3-5-S`)~`J3-5-S`,
T~JS))
View(ADR1)
View(ADR2)
ADR1 <- data_list[[1]] %>%
select( "Patient","Jour", "%Total")%>%
filter(!is.na(`%Total`))%>%
rename(value = `%Total`)%>%
mutate(ID =str_replace(Patient, "Patient (\\d+) (\\w+)", "\\1-\\2"))%>%
pivot_wider(
names_from = "Jour",
values_from = "value",
values_fn = mean,  # Moyenne des doublons
values_fill = NA
)%>%
mutate (JS = case_when(is.na(JS)&!is.na(`J3-5-S`)~`J3-5-S`,
T~JS))%>%
rename(J3_J5=`J3-5`)%>%
dplyr::select(ID,
J0,
J3_J5,
JS)
ADR2 <- data_list[[2]] %>%
select( "Patient","Jour", "%Total")%>%
filter(!is.na(`%Total`))%>%
rename(value = `%Total`)%>%
mutate(ID = str_replace(Patient, "Patient (\\d+) (\\w+)", "\\1-\\2"))%>%
pivot_wider(
names_from = "Jour",
values_from = "value",
values_fn = mean,  # Moyenne des doublons
values_fill = NA
)%>%
mutate (`J3-5` = case_when(is.na(`J3-5`)&!is.na(J5)~J5,
T~`J3-5`),
JS = case_when(is.na(JS)&!is.na(`J3-5-S`)~`J3-5-S`,
T~JS))%>%
rename(J3_J5=`J3-5`)%>%
dplyr::select(ID,
J0,
J3_J5,
JS)
View(ADR2)
View(ADR1)
ADR1 <- data_list[[1]] %>%
select( "Patient","Jour", "%Total")%>%
filter(!is.na(`%Total`))%>%
rename(value = `%Total`)%>%
mutate(ID =str_replace(Patient, "Patient (\\d+) (\\w+)", "\\1-\\2"))%>%
pivot_wider(
names_from = "Jour",
values_from = "value",
values_fn = mean,  # Moyenne des doublons
values_fill = NA
)
View(ADR1)
ADR1 <- data_list[[1]] %>%
select( "Patient","Jour", "%Total")%>%
filter(!is.na(`%Total`))%>%
rename(value = `%Total`)%>%
mutate(ID =str_replace(Patient, "Patient (\\d+) (\\w+)", "\\1-\\2"))%>%
pivot_wider(
names_from = "Jour",
values_from = "value",
values_fn = mean,  # Moyenne des doublons
values_fill = NA
)%>%
mutate (`J3-5` = case_when(is.na(`J3-5`)&!is.na(J5)~J5,
T~`J3-5`),
JS = case_when(is.na(JS)&!is.na(`J3-5-S`)~`J3-5-S`,
T~JS))%>%
rename(J3_J5=`J3-5`)%>%
dplyr::select(ID,
J0,
J3_J5,
JS)
View(ADR1)
ADR2 <- data_list[[2]] %>%
select( "Patient","Jour", "%Total")%>%
filter(!is.na(`%Total`))%>%
rename(value = `%Total`)%>%
mutate(ID = str_replace(Patient, "Patient (\\d+) (\\w+)", "\\1-\\2"))%>%
pivot_wider(
names_from = "Jour",
values_from = "value",
values_fn = mean,  # Moyenne des doublons
values_fill = NA
)%>%
mutate (
JS = case_when(is.na(JS)&!is.na(`J3-5-S`)~`J3-5-S`,
T~JS))%>%
rename(J3_J5=`J3-5`)%>%
dplyr::select(ID,
J0,
J3_J5,
JS)
DATA <- read_delim("DATA/ADRECMO_DATA.csv", delim = ";", escape_double = FALSE, trim_ws = TRUE)%>%
mutate(nom = str_to_upper(nom),
prenom =str_to_upper(prenom),
ID = paste0(numero,"-",nom,prenom))
DATA$ID
df <- left_join(DATA, ADR1)
df
View(df)
df$ID
ADR1 <- data_list[[1]] %>%
select( "Patient","Jour", "%Total")%>%
filter(!is.na(`%Total`))%>%
rename(value = `%Total`)%>%
mutate(ID =str_replace(Patient, "Patient (\\d+) (\\w+)", "\\1-\\2"))%>%
pivot_wider(
names_from = "Jour",
names_prefix = "ADR1_",
values_from = "value",
values_fn = mean,  # Moyenne des doublons
values_fill = NA
)%>%
mutate (`J3-5` = case_when(is.na(`J3-5`)&!is.na(J5)~J5,
T~`J3-5`),
JS = case_when(is.na(JS)&!is.na(`J3-5-S`)~`J3-5-S`,
T~JS))%>%
rename(J3_J5=`J3-5`)%>%
dplyr::select(ID,
J0,
J3_J5,
JS)
ADR2 <- data_list[[2]] %>%
select( "Patient","Jour", "%Total")%>%
filter(!is.na(`%Total`))%>%
rename(value = `%Total`)%>%
mutate(ID = str_replace(Patient, "Patient (\\d+) (\\w+)", "\\1-\\2"))%>%
pivot_wider(
names_from = "Jour",
values_from = "value",
names_prefix = "ADR2_"
values_fn = mean,  # Moyenne des doublons
ADR2 <- data_list[[2]] %>%
select( "Patient","Jour", "%Total")%>%
filter(!is.na(`%Total`))%>%
rename(value = `%Total`)%>%
mutate(ID = str_replace(Patient, "Patient (\\d+) (\\w+)", "\\1-\\2"))%>%
pivot_wider(
names_from = "Jour",
values_from = "value",
names_prefix = "ADR2_" ,
values_fn = mean,  # Moyenne des doublons
values_fill = NA
)%>%
mutate (
JS = case_when(is.na(JS)&!is.na(`J3-5-S`)~`J3-5-S`,
T~JS))%>%
rename(J3_J5=`J3-5`)%>%
dplyr::select(ID,
J0,
J3_J5,
JS)
fichier <- "DATA/df_i_stabilized.xlsx"
feuilles <- excel_sheets(fichier)
data_list <- lapply(feuilles, function(feuille) {
read_excel(fichier, sheet = feuille)
})
ADR1 <- data_list[[1]] %>%
select( "Patient","Jour", "%Total")%>%
filter(!is.na(`%Total`))%>%
rename(value = `%Total`)%>%
mutate(ID =str_replace(Patient, "Patient (\\d+) (\\w+)", "\\1-\\2"))%>%
pivot_wider(
names_from = "Jour",
names_prefix = "ADR1_",
values_from = "value",
values_fn = mean,  # Moyenne des doublons
values_fill = NA
)%>%
mutate (`J3-5` = case_when(is.na(`J3-5`)&!is.na(J5)~J5,
T~`J3-5`),
JS = case_when(is.na(JS)&!is.na(`J3-5-S`)~`J3-5-S`,
T~JS))%>%
rename(J3_J5=`J3-5`)%>%
dplyr::select(ID,
J0,
J3_J5,
JS)
ADR1 <- data_list[[1]] %>%
select( "Patient","Jour", "%Total")%>%
filter(!is.na(`%Total`))%>%
rename(value = `%Total`)%>%
mutate(ID =str_replace(Patient, "Patient (\\d+) (\\w+)", "\\1-\\2"))%>%
pivot_wider(
names_from = "Jour",
names_prefix = "ADR1_",
values_from = "value",
values_fn = mean,  # Moyenne des doublons
values_fill = NA
)%>%
mutate (`ADR1_J3-5` = case_when(is.na(`ADR1_J3-5`)&!is.na(ADR1_J5)~ADR1_J5,
T~`ADR1_J3-5`),
ADR1_JS = case_when(is.na(ADR1_JS)&!is.na(`ADR1_J3-5-S`)~`ADR1_J3-5-S`,
T~ADR1_JS))%>%
rename(ADR1_J3_J5=`ADR1_J3-5`)%>%
dplyr::select(ID,
ADR1_J0,
ADR1_J3_J5,
ADR1_JS)
ADR2 <- data_list[[2]] %>%
select( "Patient","Jour", "%Total")%>%
filter(!is.na(`%Total`))%>%
rename(value = `%Total`)%>%
mutate(ID = str_replace(Patient, "Patient (\\d+) (\\w+)", "\\1-\\2"))%>%
pivot_wider(
names_from = "Jour",
values_from = "value",
names_prefix = "ADR1_" ,
values_fn = mean,  # Moyenne des doublons
values_fill = NA
)%>%
mutate (
ADR1_JS = case_when(is.na(ADR1_JS)&!is.na(`ADR1_J3-5-S`)~`ADR1_J3-5-S`,
T~ADR1_JS))%>%
rename(ADR1_J3_J5=`ADR1_J3-5`)%>%
dplyr::select(ID,
ADR1_J0,
ADR1_J3_J5,
ADR1_JS)
DATA <- read_delim("DATA/ADRECMO_DATA.csv", delim = ";", escape_double = FALSE, trim_ws = TRUE)%>%
mutate(nom = str_to_upper(nom),
prenom =str_to_upper(prenom),
ID = paste0(numero,"-",nom,prenom))
df <- left_join(DATA, ADR1)
df$ADR
df$ADR1_J0
df$ADR1_D0
list_df <- lst(ADR1,ADR2)
df <- Reduce(DATA, list_df)
df <- reduce(list_df, left_join, by = "ID")
df <- Reduce(list_df, left_join, by = "ID")
library(purrr)
df <- Reduce(list_df, left_join, by = "ID")
list_df <- lst(DATA,ADR1,ADR2)
list_df
DATA <- read_delim("DATA/ADRECMO_DATA.csv", delim = ";", escape_double = FALSE, trim_ws = TRUE)%>%
mutate(nom = str_to_upper(nom),
prenom =str_to_upper(prenom),
ID = paste0(numero,"-",nom,prenom))
list_df <- lst(DATA,ADR1,ADR2)
library(purrr)
df <- Reduce(list_df, left_join, by = "ID")
df <- Reduce(list_df, left_join)
df <- reduce(list_datasets, left_join, by = "ID")
df <- reduce(list_df, left_join, by = "ID")
df
dfADR2_J0
df$ADR2_J0
df$ADR2_J0
df$ADR1_J0.x
df$ADR2_J0.x
df <- left_join(DATA,ADR1)
df <- left_join(df, ADR2)
fichier <- "DATA/df_i_stabilized.xlsx"
feuilles <- excel_sheets(fichier)
data_list <- lapply(feuilles, function(feuille) {
read_excel(fichier, sheet = feuille)
})
ADR1 <- data_list[[1]] %>%
select( "Patient","Jour", "%Total")%>%
filter(!is.na(`%Total`))%>%
rename(value = `%Total`)%>%
mutate(ID =str_replace(Patient, "Patient (\\d+) (\\w+)", "\\1-\\2"))%>%
pivot_wider(
names_from = "Jour",
names_prefix = "ADR1_",
values_from = "value",
values_fn = mean,  # Moyenne des doublons
values_fill = NA
)%>%
mutate (`ADR1_J3-5` = case_when(is.na(`ADR1_J3-5`)&!is.na(ADR1_J5)~ADR1_J5,
T~`ADR1_J3-5`),
ADR1_JS = case_when(is.na(ADR1_JS)&!is.na(`ADR1_J3-5-S`)~`ADR1_J3-5-S`,
T~ADR1_JS))%>%
rename(ADR1_J3_J5=`ADR1_J3-5`)%>%
dplyr::select(ID,
ADR1_J0,
ADR1_J3_J5,
ADR1_JS)
ADR2 <- data_list[[2]] %>%
select( "Patient","Jour", "%Total")%>%
filter(!is.na(`%Total`))%>%
rename(value = `%Total`)%>%
mutate(ID = str_replace(Patient, "Patient (\\d+) (\\w+)", "\\1-\\2"))%>%
pivot_wider(
names_from = "Jour",
values_from = "value",
names_prefix = "ADR2_" ,
values_fn = mean,  # Moyenne des doublons
values_fill = NA
)%>%
mutate (
ADR2_JS = case_when(is.na(ADR2_JS)&!is.na(`ADR2_J3-5-S`)~`ADR2_J3-5-S`,
T~ADR2_JS))%>%
rename(ADR2_J3_J5=`ADR2_J3-5`)%>%
dplyr::select(ID,
ADR2_J0,
ADR2_J3_J5,
ADR2_JS)
#Chercher doublons
ADR1%>%
group_by(Patient, ID, Jour) %>%
summarise(n = n(), .groups = "drop") %>%
filter(n > 1)
ADR2%>%
group_by(Patient, ID, Jour) %>%
summarise(n = n(), .groups = "drop") %>%
filter(n > 1)
DATA <- read_delim("DATA/ADRECMO_DATA.csv", delim = ";", escape_double = FALSE, trim_ws = TRUE)%>%
mutate(nom = str_to_upper(nom),
prenom =str_to_upper(prenom),
ID = paste0(numero,"-",nom,prenom))
df <- reduce(df_list, left_join, by="ID")
df_list <- lst(DATA,ADR1,ADR2)
df <- reduce(df_list, left_join, by="ID")
df
df$ADR2_J0
df$ADR2_JS
df$ADR1_JS
####Version avec mediane ADR1####
ADRtot_med <- median(T1$ADR1_J0, na.rm = TRUE)
#enlever les ADRtot_D0 manquants
T_cc <-T1%>%
filter(!is.na(ADRtot_D0))
####Version avec mediane ADR1####
ADRtot_med <- median(T1$ADR1_J0, na.rm = TRUE)
ADRtot_med
T1$ADR1_J0
var.cat <- c("Gender", "HTN", "DM", "Immunodepression", "CKD", "Neurologic_deficit", "Chronic_respiratory_disease", "HF", "Cardiac_arrest_before_canul", "IABP_D0", "Intubation", "EER_D0", "Outcome", "Betablocker", "Alphablocker", "Levosimendan", "Death")
var.cont <- c("Age", "BMI", "PAS_D0", "PAD_D0", "PAM_D0", "Pulsepressure_D0", "HR_D0", "Temp_D0", "Preecmo_tte_ef", "Preecmo_tte_vtiao", "Preecmo_tte_diam_LV", "Preecmo_tte_tapse", "Preecmo_tte_vmax_s_mit_lat_LV", "NADcum_D0", "DOBUcum_D0", "pH_D0", "Sao2_D0", "Paco2_D0", "Lact_D0", "Hco3_D0", "Creat_D0", "Urea_D0", "ALAT_D0", "ASAT_D0", "Bili_D0", "PT_D0", "Tropo_i_hs_D0", "Ntprobnp_D0", "DPP3_D0", "Plq_D0","ADRtot_D0","ADRtot_D3", "ADRtot_w", "Lenght_eer", "Lenght_vm", "Time_hosp", "Time_ecmo","ADR1_J0")
var.tot <- c(var.cat, var.cont)
T1 <- DATA %>%
dplyr::select(all_of(var.tot))%>%
mutate(across(all_of(var.cont), as.numeric), #je transforme en numeric
across(all_of(var.cat), as.factor)) #je transforme en cat
T1 <- df %>%
dplyr::select(all_of(var.tot))%>%
mutate(across(all_of(var.cont), as.numeric), #je transforme en numeric
across(all_of(var.cat), as.factor)) #je transforme en cat
df <- df %>%
mutate(
Temp_D0 = round(Temp_D0, 1),
Age = as.numeric(Age),
Gender = case_when(
Gender == 0 ~ "Men",
Gender == 1 ~ "Women",
TRUE ~ as.character(Gender)
),
Outcome = case_when(
Outcome == 1 ~ "ECMO Weaning",
Outcome == 2 ~ "Bridge to Transplant",
Outcome == 3 ~ "Bridge to LVAD",
Outcome == 4 ~ "Death",
TRUE ~ as.character(Outcome)
),
Pulsepressure_D0 = PAS_D0 - PAD_D0,
icu_admiss_date = dmy(icu_admiss_date),
icu_discharge_date = dmy(icu_discharge_date),
ecmo_start_date = dmy(ecmo_start_date),
ecmo_stop_date = dmy(ecmo_stop_date),
Time_hosp = as.numeric(icu_discharge_date - icu_admiss_date),
Time_ecmo = as.numeric(ecmo_stop_date - ecmo_start_date)
)
var.cat <- c("Gender", "HTN", "DM", "Immunodepression", "CKD", "Neurologic_deficit", "Chronic_respiratory_disease", "HF", "Cardiac_arrest_before_canul", "IABP_D0", "Intubation", "EER_D0", "Outcome", "Betablocker", "Alphablocker", "Levosimendan", "Death")
var.cont <- c("Age", "BMI", "PAS_D0", "PAD_D0", "PAM_D0", "Pulsepressure_D0", "HR_D0", "Temp_D0", "Preecmo_tte_ef", "Preecmo_tte_vtiao", "Preecmo_tte_diam_LV", "Preecmo_tte_tapse", "Preecmo_tte_vmax_s_mit_lat_LV", "NADcum_D0", "DOBUcum_D0", "pH_D0", "Sao2_D0", "Paco2_D0", "Lact_D0", "Hco3_D0", "Creat_D0", "Urea_D0", "ALAT_D0", "ASAT_D0", "Bili_D0", "PT_D0", "Tropo_i_hs_D0", "Ntprobnp_D0", "DPP3_D0", "Plq_D0","ADRtot_D0","ADRtot_D3", "ADRtot_w", "Lenght_eer", "Lenght_vm", "Time_hosp", "Time_ecmo","ADR1_J0")
var.tot <- c(var.cat, var.cont)
T1 <- df %>%
dplyr::select(all_of(var.tot))%>%
mutate(across(all_of(var.cont), as.numeric), #je transforme en numeric
across(all_of(var.cat), as.factor)) #je transforme en cat
library(tableone)
library(dplyr)
library(naniar)
library(tidyr)
####Version avec mediane ADR1####
ADR1_med <- median(T1$ADR1_J0, na.rm = TRUE)
T1 <- T1%>%
mutate(ADRtot_strata_med = case_when(ADRtot_D0>ADRtot_med ~ "HIGH",
T~"LOW"))
T1 <- T1%>%
mutate(ADRtot_strata_med = case_when(ADRtot_D0>ADRtot_med ~ "HIGH",
ADRtot_D0<=ADRtot_med ~ "LOW",
T~NA))
####Version avec mediane ADR1####
ADR1_med <- median(T1$ADR1_J0, na.rm = TRUE)
T1 <- T1%>%
mutate(ADR1_strata_med = case_when(ADR1_J0>ADR1_med ~ "HIGH",
ADR1_J0<=ADR1_med ~ "LOW",
T~NA))
T1 <- CreateTableOne(vars = var.tot,
factorVars = var.cat,
strata = "ADR1_strata_med",
data = T1)
table_1 <- as.data.frame(print(T1, nonnormal = var.cont))
table_1$variables <-row.names(table_1)
table_1 <- table_1[,c(5, 1,2,3)]
names(table_1)
TABLE1 <- flextable(table_1)
save_as_docx(TABLE1, path = "TABLES/TABLE1_mediane.docx")
table_1 <- table_1[,c(5, 1,2,3)]
table_1$variables <-row.names(table_1)
table_1 <- table_1[,c(5, 1,2,3)]
T1 <- CreateTableOne(vars = var.tot,
factorVars = var.cat,
strata = "ADR1_strata_med",
data = T1)
table_1 <- as.data.frame(print(T1, nonnormal = var.cont))
table_1 <- as.data.frame(print(T1, nonnormal = var.cont))
table_1$variables <-row.names(table_1)
names(table_1)
table_1 <- table_1[,c(5, 1,2,3)]
table_1
TABLE1 <- flextable(table_1)
save_as_docx(TABLE1, path = "TABLES/TABLE1_mediane.docx")
####Version avec mediane ADR1####
ADR2_med <- median(T1$ADR2_J0, na.rm = TRUE)
ADR2_med
var.cont <- c("Age", "BMI", "PAS_D0", "PAD_D0", "PAM_D0", "Pulsepressure_D0", "HR_D0", "Temp_D0", "Preecmo_tte_ef", "Preecmo_tte_vtiao", "Preecmo_tte_diam_LV", "Preecmo_tte_tapse", "Preecmo_tte_vmax_s_mit_lat_LV", "NADcum_D0", "DOBUcum_D0", "pH_D0", "Sao2_D0", "Paco2_D0", "Lact_D0", "Hco3_D0", "Creat_D0", "Urea_D0", "ALAT_D0", "ASAT_D0", "Bili_D0", "PT_D0", "Tropo_i_hs_D0", "Ntprobnp_D0", "DPP3_D0", "Plq_D0","ADRtot_D0","ADRtot_D3", "ADRtot_w", "Lenght_eer", "Lenght_vm", "Time_hosp", "Time_ecmo","ADR1_J0","ADR2_J0")
var.tot <- c(var.cat, var.cont)
####Version avec mediane ADR1####
ADR2_med <- median(T1$ADR2_J0, na.rm = TRUE)
T2 <- T2%>%
mutate(ADR2_strata_med = case_when(ADR2_J0>ADR2_med ~ "HIGH",
ADR2_J0<=ADR2_med ~ "LOW",
T~NA))
T2 <- df%>%
mutate(ADR2_strata_med = case_when(ADR2_J0>ADR2_med ~ "HIGH",
ADR2_J0<=ADR2_med ~ "LOW",
T~NA))
####Version avec mediane ADR1####
ADR2_med <- median(df$ADR2_J0, na.rm = TRUE)
ADR2_med
T2 <- df%>%
mutate(ADR2_strata_med = case_when(ADR2_J0>ADR2_med ~ "HIGH",
ADR2_J0<=ADR2_med ~ "LOW",
T~NA))
T2 <- CreateTableOne(vars = var.tot,
factorVars = var.cat,
strata = "ADR2_strata_med",
data = T2)
table_2 <- as.data.frame(print(T2, nonnormal = var.cont))
table_2$variables <-row.names(table_2)
table_2 <- table_2[,c(5, 1,2,3)]
names(table_1)
TABLE2 <- flextable(table_2)
save_as_docx(TABLE2, path = "TABLES/TABLE2_mediane_ADRB2.docx")
save_as_docx(TABLE1, path = "TABLES/TABLE1_mediane_ADRB1.docx")
